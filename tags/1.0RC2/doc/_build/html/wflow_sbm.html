


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The wflow_sbm Model &mdash; wflow 1.0RC1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'',
        VERSION:'1.0RC1',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="wflow 1.0RC1 documentation" href="index.html"/>
        <link rel="next" title="The wflow_gr4 model" href="wflow_gr4.html"/>
        <link rel="prev" title="The wflow_hbv model" href="wflow_hbv.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> wflow</a>
        <form class="wy-form" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_hbv.html">The wflow_hbv model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_hbv.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_hbv.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_hbv.html#module-wflow_hbv">Description of the python module</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">The wflow_sbm Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-rainfall-interception-model">The rainfall interception model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-soil-model">The soil model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kinematic-wave-and-river-width">Kinematic wave and River Width</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-wave">Dynamic wave</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-variables-stores-and-fluxes">Model variables stores and fluxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#processing-of-meteorological-forcing-data">Processing of meteorological forcing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#guidelines-for-wflowsbm-model-parameters">Guidelines for wflowsbm model parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-wflow_sbm">wflow_sbm module documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_gr4.html">The wflow_gr4 model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_gr4.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_gr4.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_gr4.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_gr4.html#module-wflow_gr4">wflow_gr4 module documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_wave.html">THe wflow_wave Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_wave.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_wave.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_wave.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_wave.html#module-wflow_wave">wflow_wave module documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_floodmap.html">The wflow_floodmap model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_floodmap.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_floodmap.html#module-wflow_floodmap">Description of the python module</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_adapt.html">wflow_adapt Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_adapt.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_adapt.html#linking-wflow-models-to-delft-fews">Linking wflow models to Delft-FEWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_adapt.html#how-to-use-the-adapter">How to use the adapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_adapt.html#module-wflow_adapt">Module function documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_building.html">Building a model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#data-requirements">Data requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#setting-up-a-new-model">Setting-up a new model</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#preparing-static-input-maps">Preparing static input maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#module-wflow_prepare_step1">Script documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#setting-up-a-case">Setting Up a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#input-parameters-lookup-tables-or-maps">Input parameters (lookup tables or maps)</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#calibrating-the-wflow-sbm-model">Calibrating the  wflow_sbm model</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_building.html#common-problems">Common problems</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_usage.html">Using the models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_usage.html#directory-structure-cases-and-runs">Directory structure: cases and runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_usage.html#running-the-model">Running the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_usage.html#wflow-sbm-hbv-ini-file">wflow_sbm|hbv.ini file</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_usage.html#updating-using-measured-data">Updating using measured data</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_usage.html#all-possible-options-in-wflow-sbm-ini-file">All possible options in wflow_sbm.ini file</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_fit.html">The wflow_fit module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_fit.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_fit.html#the-ini-file">The ini file</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_fit.html#fitting-results">Fitting results</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_fit.html#how-to-fit">How to fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_fit.html#module-wflow_fit">Description of the python module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wflow_lib.html">wflow_lib Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_lib.html#wflow-lib-terrain-analysis-and-hydrological-library">wflow_lib - terrain analysis and hydrological library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wflow_delwaq.html">wflow_delwaq Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wflow_delwaq.html#how-the-script-works">How the script works</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_delwaq.html#very-simple-example">Very simple example:</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_delwaq.html#case-study-for-malaysia-and-singapore">Case study for Malaysia and Singapore</a></li>
<li class="toctree-l2"><a class="reference internal" href="wflow_delwaq.html#module-wflow_delwaq">wflow_delwaq module documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="testrunner_wflowhbv.html">run wflow_hbv via API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="testrunner_wflowhbv.html#settings-in-the-ini-file">Settings in the ini file</a></li>
<li class="toctree-l2"><a class="reference internal" href="testrunner_wflowhbv.html#settings-in-the-api-section">Settings in the API section</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="calib_report.html">Calibration of the wflow_sbm model for the Rhine catchment using EOBS data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="calib_report.html#dem-and-landuse-data">DEM and landuse data</a></li>
<li class="toctree-l2"><a class="reference internal" href="calib_report.html#forcing-data">Forcing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="calib_report.html#calibration-procedure">Calibration procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="calib_report.html#original-landuse">Original landuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="calib_report.html#modified-landuse">Modified landuse</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="framework.html">Using the framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="framework.html#definition-of-the-wflow-sceleton-model">Definition of the wflow_sceleton model.</a></li>
<li class="toctree-l2"><a class="reference internal" href="framework.html#anotated-source-code-for-the-above">Anotated source code for the above</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wf_DynamicFramework.html">wf_DynamicFramework Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wf_DynamicFramework.html#wf-dynamicframework">wf_DynamicFramework</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Questions and answers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#questions">Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#answers">Answers</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wflow_openda.html">Linking wflow to OpenDA</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">wflow</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">The wflow_sbm Model</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="the-wflow-sbm-model">
<h1>The wflow_sbm Model<a class="headerlink" href="#the-wflow-sbm-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The soil part of wflow_sbm model follows the same concepts as the
topog_sbm model. topog_sbm is specifically designed to similate fast
runoff processes in small catchments while wflow_sbm can be applied more
widely. The main differences are:</p>
<ul class="simple">
<li>The addition of evapotranspiration losses</li>
<li>The addition of a percolary rise</li>
<li>Wflow routes water over a D8 network while topog uses an element
network based on contour lines and trajectories.</li>
<li>The (optional) addition of sub-cell runoff to be able to
run on larger grid sizes</li>
</ul>
<p>The sections below describe the working of the model in more detail.</p>
</div>
<div class="section" id="the-rainfall-interception-model">
<h2>The rainfall interception model<a class="headerlink" href="#the-rainfall-interception-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-analytical-gash-model">
<h3>The analytical (Gash) model<a class="headerlink" href="#the-analytical-gash-model" title="Permalink to this headline">¶</a></h3>
<p>The analytical model of rainfall interception is based on Rutter’s
numerical model . The simplifications that introduced allow the model to
be applied on a daily basis, although a storm-based approach will yield
better results in situations with more than one storm per day . The
amount of water needed to completely saturate the canopy is defined as:</p>
<div class="math">
<p><img src="_images/math/97788e032bc53b0d0f381443d442f373b77550c2.png" alt="P'=\frac{-\overline{R}S}{\overline{E}_{w}}ln\left[1-\frac{\overline{E}_{w}}{\overline{R}}(1-p-p_{t})^{-1}\right]"/></p>
</div><p>where <img class="math" src="_images/math/753dc004105a6b3c558defb100e77a617e26971c.png" alt="\overline{R}"/> is the average precipitation intensity on a saturated canopy
and <img class="math" src="_images/math/016077691cf3f8cb8f1118af45ebbc598b8c1149.png" alt="\overline{E}_{w}"/> the average evaporation from the wet canopy
and with the vegetation parameters <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/>, <img class="math" src="_images/math/36f73fc1312ee0349b3f3a0f3bd9eb5504339011.png" alt="p"/> and <img class="math" src="_images/math/aeeea574f48a72b8c8e6b341469ff891d6ff6c97.png" alt="p_t"/> as defined
previously. The model uses a series of expressions to calculate the
interception loss during different phases of a storm.
An analytical integration of the total evaporation and rainfall under
saturated canopy conditions is then done for each storm to determine
average values of <img class="math" src="_images/math/016077691cf3f8cb8f1118af45ebbc598b8c1149.png" alt="\overline{E}_{w}"/> and <img class="math" src="_images/math/753dc004105a6b3c558defb100e77a617e26971c.png" alt="\overline{R}"/>.
The total evaporation from the canopy ( the
total interception loss) is calculated as the sum of the components
listed in the table below. Interception losses from the stems are
calculated for days with <img class="math" src="_images/math/ce8c1b7a751f542f6bb526e17da29fa59176d5aa.png" alt="P\geq S_{t}/p_{t}"/> . <img class="math" src="_images/math/aeeea574f48a72b8c8e6b341469ff891d6ff6c97.png" alt="p_t"/> and <img class="math" src="_images/math/93d5be9bdec94fc912e4bc9b74fc6812a19e186e.png" alt="S_t"/> are
small and neglected in the wflow_sbm model.</p>
<p>Table: Formulation of the components of interception loss  according to Gash:</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="7%" />
<col width="8%" />
<col width="28%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>For <img class="math" src="_images/math/f5047d1e0cbb50ec208923a22cd517c55100fa7b.png" alt="m"/> small storms (<img class="math" src="_images/math/52fa6bf3df5cf59842c84ba04ba4554d373be8fc.png" alt="P_{g}&lt;{P'}_{g}"/>)</td>
<td colspan="3"><img class="math" src="_images/math/f4b8518db97648f06ace55c38b6b8c191014f51c.png" alt="(1-p-p_{t})\sum_{j=1}^{m}P_{g,j}"/></td>
</tr>
<tr class="row-even"><td>Wetting up the canopy in <img class="math" src="_images/math/174fadd07fd54c9afe288e96558c92e0c1da733a.png" alt="n"/> large storms (<img class="math" src="_images/math/6f5018be9adcd30e578ddb1f5cc230af608e2ea7.png" alt="P_{g}\geq{P'}_{g}"/>)</td>
<td colspan="3"><img class="math" src="_images/math/5e9808b346f44fa1c112ab8ba134de03cbeae7a1.png" alt="n(1-p-p_{t}){P'}_{g}-nS"/></td>
</tr>
<tr class="row-odd"><td>Evaporation from saturated canopy during rainfall</td>
<td colspan="3"><img class="math" src="_images/math/86fcf6a1663155b3efa017c8c170d7d66b5da902.png" alt="\overline{E}/\overline{R}\sum_{j=1}^{n}(P_{g,j}-{P'}_{g})"/></td>
</tr>
<tr class="row-even"><td>Evaporation after rainfall ceases for <img class="math" src="_images/math/174fadd07fd54c9afe288e96558c92e0c1da733a.png" alt="n"/> large storms</td>
<td colspan="3"><img class="math" src="_images/math/cd09579342b09a4c67f1d270964bb6b4c2dcc5b8.png" alt="nS"/></td>
</tr>
<tr class="row-odd"><td>Evaporation from trunks in <img class="math" src="_images/math/0615acc3725de21025457e7d6f7694dab8e2f758.png" alt="q"/> storms that  fill the trunk storage</td>
<td colspan="3"><img class="math" src="_images/math/b3bc840232910bf1af78283c6bdeb32821962e18.png" alt="qS_{t}"/></td>
</tr>
<tr class="row-even"><td>Evaporation from  trunks in (<img class="math" src="_images/math/bdd7cd7dc93671df8ea61de8f4c691b6b263bb00.png" alt="m+n-q"/>) storms that do not fill the trunk  storage</td>
<td colspan="3"><img class="math" src="_images/math/bb0fc9d7b5344fd746e0a1bb70982b307f454b77.png" alt="p_{t}\sum_{j=1}^{m+n-q}P_{g,j}"/></td>
</tr>
</tbody>
</table>
<p>In applying the analytical model, saturated conditions are assumed to
occur when the hourly rainfall exceeds a certain threshold. Often a
threshold of 0.5 mm/hr is used . <img class="math" src="_images/math/753dc004105a6b3c558defb100e77a617e26971c.png" alt="\overline{R}"/> is calculated for all hours when the
rainfall exceeds the threshold to give an estimate of the mean rainfall
rate onto a saturated canopy.</p>
<p>Gash (1979) has shown that in a regression of interception loss on rainfall (on a
storm basis) the regression coefficient should equal to <img class="math" src="_images/math/dd2b0768075898b43da7365acc02eed22b7aaed5.png" alt="\overline{E}_w/\overline{R}"/>. Assuming that
neither <img class="math" src="_images/math/86660b75377bfb1db0ed2021dc9333b49767f867.png" alt="\overline{E}_w"/> nor <img class="math" src="_images/math/753dc004105a6b3c558defb100e77a617e26971c.png" alt="\overline{R}"/> vary considerably in time, <img class="math" src="_images/math/86660b75377bfb1db0ed2021dc9333b49767f867.png" alt="\overline{E}_w"/> can be estimated in this
way from <img class="math" src="_images/math/753dc004105a6b3c558defb100e77a617e26971c.png" alt="\overline{R}"/> in the absence of above-canopy climatic observations .
Values derived in this way generally tend to be (much) higher than
those calculated with the penman-montieth equation .</p>
</div>
<div class="section" id="the-modified-rutter-model">
<h3>The modified rutter model<a class="headerlink" href="#the-modified-rutter-model" title="Permalink to this headline">¶</a></h3>
<p>For subdaily timesteps the model uses a simplification of the Rutter model. The simplyfied
model is solved explicitly and does not take drainage from the canopy into account.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">rainfall_interception_modrut</span><span class="p">(</span><span class="n">Precipitation</span><span class="p">,</span><span class="n">PotEvap</span><span class="p">,</span><span class="n">CanopyStorage</span><span class="p">,</span><span class="n">CanopyGapFraction</span><span class="p">,</span><span class="n">Cmax</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Interception according to a modified Rutter model. The model is solved</span>
<span class="sd">   explicitly and there is no drainage below Cmax.</span>

<span class="sd">   Returns:</span>
<span class="sd">       - NetInterception: P - TF - SF (may be different from the actual wet canopy evaporation)</span>
<span class="sd">       - ThroughFall:</span>
<span class="sd">       - StemFlow:</span>
<span class="sd">       - LeftOver: Amount of potential eveporation not used</span>
<span class="sd">       - Interception: Actual wet canopy evaporation in this thimestep</span>
<span class="sd">       - CanopyStorage: Canopy storage at the end of the timestep</span>

<span class="sd">   &quot;&quot;&quot;</span>

   <span class="c">##########################################################################</span>
   <span class="c"># Interception according to a modified Rutter model with hourly timesteps#</span>
   <span class="c">##########################################################################</span>

   <span class="n">p</span> <span class="o">=</span> <span class="n">CanopyGapFraction</span>
   <span class="n">pt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">p</span>

   <span class="c"># Amount of P that falls on the canopy</span>
   <span class="n">Pfrac</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span><span class="n">pt</span><span class="p">)</span> <span class="o">*</span> <span class="n">Precipitation</span>

   <span class="c"># S cannot be larger than Cmax, no gravity drainage below that</span>
   <span class="n">DD</span> <span class="o">=</span> <span class="n">ifthenelse</span> <span class="p">(</span><span class="n">CanopyStorage</span> <span class="o">&gt;</span> <span class="n">Cmax</span> <span class="p">,</span> <span class="n">Cmax</span> <span class="o">-</span> <span class="n">CanopyStorage</span> <span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">CanopyStorage</span> <span class="o">=</span> <span class="n">CanopyStorage</span> <span class="o">-</span> <span class="n">DD</span>

   <span class="c"># Add the precipitation that falls on the canopy to the store</span>
   <span class="n">CanopyStorage</span> <span class="o">=</span> <span class="n">CanopyStorage</span> <span class="o">+</span> <span class="n">Pfrac</span>

   <span class="c"># Now do the Evap, make sure the store does not get negative</span>
   <span class="n">dC</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">CanopyStorage</span><span class="p">,</span> <span class="n">PotEvap</span><span class="p">)</span>
   <span class="n">CanopyStorage</span> <span class="o">=</span> <span class="n">CanopyStorage</span> <span class="o">+</span> <span class="n">dC</span>

   <span class="n">LeftOver</span> <span class="o">=</span> <span class="n">PotEvap</span> <span class="o">+</span><span class="n">dC</span><span class="p">;</span> <span class="c"># Amount of evap not used</span>


   <span class="c"># Now drain the canopy storage again if needed...</span>
   <span class="n">D</span> <span class="o">=</span> <span class="n">ifthenelse</span> <span class="p">(</span><span class="n">CanopyStorage</span> <span class="o">&gt;</span> <span class="n">Cmax</span> <span class="p">,</span> <span class="n">CanopyStorage</span> <span class="o">-</span> <span class="n">Cmax</span> <span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
   <span class="n">CanopyStorage</span> <span class="o">=</span> <span class="n">CanopyStorage</span> <span class="o">-</span> <span class="n">D</span>

   <span class="c"># Calculate throughfall</span>
   <span class="n">ThroughFall</span> <span class="o">=</span> <span class="n">DD</span> <span class="o">+</span> <span class="n">D</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="n">Precipitation</span>
   <span class="n">StemFlow</span> <span class="o">=</span> <span class="n">Precipitation</span> <span class="o">*</span> <span class="n">pt</span>

   <span class="c"># Calculate interception, this is NET Interception</span>
   <span class="n">NetInterception</span> <span class="o">=</span> <span class="n">Precipitation</span> <span class="o">-</span> <span class="n">ThroughFall</span> <span class="o">-</span> <span class="n">StemFlow</span>
   <span class="n">Interception</span> <span class="o">=</span> <span class="o">-</span><span class="n">dC</span>

   <span class="k">return</span> <span class="n">NetInterception</span><span class="p">,</span> <span class="n">ThroughFall</span><span class="p">,</span> <span class="n">StemFlow</span><span class="p">,</span> <span class="n">LeftOver</span><span class="p">,</span> <span class="n">Interception</span><span class="p">,</span> <span class="n">CanopyStorage</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-soil-model">
<h2>The soil model<a class="headerlink" href="#the-soil-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="infiltration">
<h3>Infiltration<a class="headerlink" href="#infiltration" title="Permalink to this headline">¶</a></h3>
<p>If the surface is (partly) saturated the rainfall that falls onto the
saturated area is added to the surface runoff component. Infiltration of
the remaining water is determined as follows:</p>
<p>First the soil infiltration capacity is adjusted in case the soil is
frozen. The remaining storage capacity of the unsaturated store is
determined. The infiltrating water is split is two parts, the part that
fall on compacted areas and the part that fall on non-compacted areas.
First the amount of water that infiltrates in non-compacted areas is
calculated by taking the mimimum of the remaining storage capacity, the
maximum soil infiltration rate and the water on non-compated areas.
After adding the infiltrated water to the unsaturated store the same is
done for the compated areas after updatting the remaining storage
capacity.</p>
</div>
<div class="section" id="the-wflow-sbm-soil-water-accounting-scheme">
<h3>The wflow_sbm soil water accounting scheme<a class="headerlink" href="#the-wflow-sbm-soil-water-accounting-scheme" title="Permalink to this headline">¶</a></h3>
<p>A detailed description of the SBM model has been given by <a class="reference internal" href="#vertessy">[vertessy]</a>. Briefly:
the soil is considered as a bucket with a certain depth
(<img class="math" src="_images/math/768e49b100713b44862cafb313c32dc47cec6bd6.png" alt="z_{t}"/>), divided into a saturated store (<img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/>) and an
unsaturated store (<img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/>), the magnitudes of which are expressed
in units of depth. The top of the <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> store forms a pseudo-water
table at depth <img class="math" src="_images/math/f90701df8a21fa64cddb49f54724a7258df00531.png" alt="z_{i}"/> such that the value of <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> at any
time is given by:</p>
<div class="math">
<p><img src="_images/math/1d7bf6fa1384e46490a369ebd16c34d91e2d2aa1.png" alt="S=(z_{t}-z_{i})(\theta_{s}-\theta_{r})"/></p>
</div><p>where:</p>
<p><img class="math" src="_images/math/f833307a248d8e8079758a58e00710f2759c898a.png" alt="\theta_{s}"/> and <img class="math" src="_images/math/a4cc29f53f4391abd79cc42c19b1f0c0582d6500.png" alt="\theta_{r}"/> are the
saturated and residual soil water contents, respectively.</p>
<p>The unsaturated store (<img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/>) is subdivided into storage
(<img class="math" src="_images/math/00dcb66409de2de86ad27b1c64d531d33cd37536.png" alt="U_{s}"/>) and deficit (<img class="math" src="_images/math/57ef46bc6ff9a52592e4d1b410b05fb50a82eb66.png" alt="U_{d}"/>) which are again
expressed in units of depth:</p>
<div class="math">
<p><img src="_images/math/73ff671f0f60895010bdfe54412977d2d873ada4.png" alt="U_{d}=(\theta_{s}-\theta_{r})z_{i}-U

U_{s}=U-U_{d}"/></p>
</div><p>The saturation deficit (<img class="math" src="_images/math/2e1273d99bf6f88265cecd80df1ba472b355da4e.png" alt="S_{d}"/>) for the soil profile as a
whole is defined as:</p>
<div class="math">
<p><img src="_images/math/fe3045b1f6f5fe6aa12262755f3e7d2babce0583.png" alt="S_{d}=(\theta_{s}-\theta_{r})z_{t}-S"/></p>
</div><p>All infiltrating rainfall enters the <img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/> store first. The
transfer of water from the <img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/> store to the <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> store
(<img class="math" src="_images/math/38611983906dda3650ff03bf618700fda7a09a4e.png" alt="st"/>) is controlled by the saturated hydraulic conductivity {}
at depth <img class="math" src="_images/math/f90701df8a21fa64cddb49f54724a7258df00531.png" alt="z_{i}"/> and the ratio between <img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/> and
<img class="math" src="_images/math/2e1273d99bf6f88265cecd80df1ba472b355da4e.png" alt="S_{d}"/>:</p>
<div class="math">
<p><img src="_images/math/6c9ee977a0a1d32f55dc6ad45b28db61966c0a5c.png" alt="st=K_{\mathit{sat}}\frac{U_{s}}{S_{d}}"/></p>
</div><p>Hence, as the saturation deficit becomes smaller, the rate of the
transfer between the <img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/> and <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> stores increases.</p>
<div class="figure">
<img alt="_images/wflow_soil.png" src="_images/wflow_soil.png" />
<p class="caption">Schematisation of the soil within the wflow_sbm model</p>
</div>
<p>Saturated conductivity (<img class="math" src="_images/math/87039f9be109173d5b30bec3381160b646eda812.png" alt="K_{sat}"/>) declines with soil depth (<img class="math" src="_images/math/b13f21416d84e13708696f34dea81026cda583c9.png" alt="z"/>) in
the model according to:</p>
<p>where:</p>
<blockquote>
<div><p><img class="math" src="_images/math/c152b73ddead0a8c81c82986c7985baa0449d300.png" alt="K_{0}"/> is the saturated conductivity at the soil surface and</p>
<p><img class="math" src="_images/math/bb2c93730dbb48558bb3c4738c956c4e8f816437.png" alt="f"/> is a scaling parameter [<img class="math" src="_images/math/123108aff1e6a7f9bf1fac70463f449280af077f.png" alt="m^{-1}"/>]</p>
</div></blockquote>
<p>The scaling parameter <img class="math" src="_images/math/bb2c93730dbb48558bb3c4738c956c4e8f816437.png" alt="f"/> is defined by:</p>
<p><img class="math" src="_images/math/9f9d2e925ec88a9c5e7dc42396200b8e61d188f6.png" alt="f=\frac{\theta_{s}-\theta_{r}}{M}"/></p>
<p>with <img class="math" src="_images/math/f833307a248d8e8079758a58e00710f2759c898a.png" alt="\theta_{s}"/> and <img class="math" src="_images/math/a4cc29f53f4391abd79cc42c19b1f0c0582d6500.png" alt="\theta_{r}"/> as defined
previously and <img class="math" src="_images/math/5d1e4485dc90c450e8c76826516c1b2ccb8fce16.png" alt="M"/> representing a model parameter (expressed in
meters).</p>
<p>Figure: Plot of the relation between depth and conductivity for different values of M</p>
<p>(<a class="reference external" href="./plots/m-plot.py">Source code</a>, <a class="reference external" href="./plots/m-plot.png">png</a>, <a class="reference external" href="./plots/m-plot.hires.png">hires.png</a>, <a class="reference external" href="./plots/m-plot.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/m-plot.png" src="_images/m-plot.png" />
</div>
<p>The <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> store can be drained laterally via subsurface flow
according to:</p>
<p><img class="math" src="_images/math/772ab373466b775b4891af1ea9fa6067dda557b5.png" alt="sf=K_{0}\mathit{tan}(\beta)e^{-S_{d}/M}"/></p>
<p>where:</p>
<blockquote>
<div><p><img class="math" src="_images/math/fdb63b9e51abe6bbb16acfb5d7b773ddbb5bf4a8.png" alt="\beta"/> is element slope angle [deg.]</p>
<p><img class="math" src="_images/math/e988b1e0382b9735b66371e029432d703170bd0e.png" alt="sf"/> is the calculated subsurface flow [<img class="math" src="_images/math/ecd90a8fe15719299b40d1605da6af4992371509.png" alt="m^{2}d^{-1}"/>]</p>
<p><img class="math" src="_images/math/2e1273d99bf6f88265cecd80df1ba472b355da4e.png" alt="S_{d}"/> is the saturation deficit defined as:    (<img class="math" src="_images/math/942b62ea09a33486a2afaeda353e6549764ce61e.png" alt="(\theta_{s}-\theta_{r})z_{t}-S"/>)</p>
</div></blockquote>
<p>with <img class="math" src="_images/math/5d1e4485dc90c450e8c76826516c1b2ccb8fce16.png" alt="M"/> and <img class="math" src="_images/math/2e1273d99bf6f88265cecd80df1ba472b355da4e.png" alt="S_{d}"/> as defined previously. A schematic
representation of the various hydrological processes and pathways
modelled by SBM (infiltration, exfiltration, Hortonian and saturation
overland flow, subsurface flow) is provided by verstessy (1999).</p>
<p>The original SBM model does not include transpiration or a notion of
capilary rise. In  wflow_sbm  transpiration is first taken from the
<img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> store if the roots reach the water table <img class="math" src="_images/math/f90701df8a21fa64cddb49f54724a7258df00531.png" alt="z_{i}"/>. If
the <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> store cannot satisfy the demand the <img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/> store is
used next. First the number of wet roots is determined (going from 1 to 0) using
an sigmoid function as follows:</p>
<div class="math">
<p><img src="_images/math/2e6d61376172952433fc7b4e5095aedb4ceb2076.png" alt="WetRoots = 1.0/(1.0 + e^{-SharpNess (WaterTable - RootingDepth)})"/></p>
</div><p>Here the sharpness parameter (by default a large negative value, -80000.0) parameter
determines if there is a stepwise output or a more gradual output (default is stepwise).
WaterTable is the level of the Water table in the gridcell in mm below the
surface, RootingDepth is the maximum depth of the roots also in mm below the
surface. For all values of WaterTable smaller that RootingDepth a
value of 1 is returned if they are
equal a value of 0.5 is returned if the WaterTable is larger than the RootingDepth
a value of 0 is returned. The returned WetRoots fraction is multiplied
by the potential evaporation (and limited by the available water in saturated zone)
to get the transpiration from the saturated part of the soil.</p>
<p>Figure: Plot showing the fraction of wet roots for different values of c
for a RootingDepth of 275mm</p>
<p>(<a class="reference external" href="./plots/s-curve-soil.py">Source code</a>, <a class="reference external" href="./plots/s-curve-soil.png">png</a>, <a class="reference external" href="./plots/s-curve-soil.hires.png">hires.png</a>, <a class="reference external" href="./plots/s-curve-soil.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/s-curve-soil.png" src="_images/s-curve-soil.png" />
</div>
<p>Next the remaining potential evaporation is used to extract water from the
unsaturated store:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">FirstZoneDepth</span> <span class="o">=</span> <span class="n">FirstZoneDepth</span> <span class="o">-</span> <span class="n">ActEvapSat</span>
<span class="n">RestPotEvap</span> <span class="o">=</span> <span class="n">PotTrans</span> <span class="o">-</span> <span class="n">ActEvapSat</span>

<span class="c"># now try unsat store</span>
<span class="n">AvailCap</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="nb">max</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,(</span><span class="n">WTable</span> <span class="o">-</span> <span class="n">RootingDepth</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">RootingDepth</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)))</span>

<span class="n">MaxExtr</span> <span class="o">=</span> <span class="n">AvailCap</span>  <span class="o">*</span> <span class="n">UStoreDepth</span>
<span class="n">ActEvapUStore</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">MaxExtr</span><span class="p">,</span><span class="n">RestPotEvap</span><span class="p">,</span><span class="n">UStoreDepth</span><span class="p">)</span>
<span class="n">UStoreDepth</span> <span class="o">=</span> <span class="n">UStoreDepth</span> <span class="o">-</span> <span class="n">ActEvapUStore</span>

<span class="n">ActEvap</span> <span class="o">=</span> <span class="n">ActEvapSat</span> <span class="o">+</span> <span class="n">ActEvapUStore</span>
</pre></div>
</div>
<p>Capilary rise is determined using the following approach:
first the <img class="math" src="_images/math/87039f9be109173d5b30bec3381160b646eda812.png" alt="K_{sat}"/> is determined at the water table
<img class="math" src="_images/math/f90701df8a21fa64cddb49f54724a7258df00531.png" alt="z_{i}"/>; next a potential capilary rise is determined from the
minimum of the <img class="math" src="_images/math/87039f9be109173d5b30bec3381160b646eda812.png" alt="K_{sat}"/>, the actual transpiration taken from
the <img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/> store, the available water in the <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> store and
the deficit of the <img class="math" src="_images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U"/> store. Finally the potential rise is
scaled using the distance between the roots and the water table using:</p>
<blockquote>
<div><img class="math" src="_images/math/520cd00d75450d8998f40f9a0aadd49fef7c0907.png" alt="CS=CSF/(CSF+z_{i}-RT)"/></div></blockquote>
<p>in which <img class="math" src="_images/math/5d9f1ff4706cf9340a5a24d275fafb46157c9b54.png" alt="CS"/> is the scaling factor to multiply the potential
rise with, <img class="math" src="_images/math/3ed165af6753f30104b941ceb79cdaf3f9570603.png" alt="CSF"/> is a model parameter (default = 100, use
CapScale.tbl to set differently) and <img class="math" src="_images/math/b8fe0bc1f0ab90d60df20bc9e4ccac77d35238e1.png" alt="RT"/> the rooting depth. If
the roots reach the water table (<img class="math" src="_images/math/7c9cec996318780fb2c1ec461d6b28e1cc3c40be.png" alt="RT&gt;z_{i}"/>) <img class="math" src="_images/math/5d9f1ff4706cf9340a5a24d275fafb46157c9b54.png" alt="CS"/> is set
to zero thus setting the capilary rise to zero.</p>
<ol class="arabic simple">
<li>Water in the saturated store is transferred laterally along the DEM
using the following steps:<ol class="arabic">
<li>a maximum flux for each cell is determined by determining the {}
over the saturated part and the available water in each cell</li>
<li>water is routed downslope (using the PCRaster accucapacityflux
operator) by multiplying the {} by the slope and limiting the flux
the the maximum determined in the previous step</li>
<li>the program can either use the DEM to route the water or (more
appropriate in flat areas) the actual slope of the water table.
The latter option slows down the program considerably</li>
</ol>
</li>
<li>surplus water in cells as a result of the previous step is added to
the kinematic wave reservoir</li>
</ol>
</div>
<div class="section" id="soil-temperature">
<h3>Soil temperature<a class="headerlink" href="#soil-temperature" title="Permalink to this headline">¶</a></h3>
<p>The near surface soil temperature is modelled using a simple equation <a class="reference internal" href="#wigmosta">[Wigmosta]</a>:</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/a3bdf7d1786c14cc0e0202e91b7867e726615be8.png" alt="T_s^{t} = T_s^{t-1} + w  (T_a - T_s^{t-1})"/></p>
</div></div></blockquote>
<p>where <img class="math" src="_images/math/76c2ee3aecba05a6233c4975b2dcc1870104f8e3.png" alt="T_s^{t}"/>  is the near-surface soil temperature at time t, <img class="math" src="_images/math/e58864fe606c6a429f1e9a6fcfa945de432e67d8.png" alt="T_a"/> is air temperature and <img class="math" src="_images/math/9ee4b825a2e36ae093ed7be5e4851ef453b34914.png" alt="w"/> is a
weighting coefficient determined through calibration (default is 0.1125 for daily timesteps, 0.9 for 3-hourly timesteps)</p>
<p>if T_s &lt; 0 than a K_{sat} reduction factor (default 0.038) is applied. An S-curve (see plot below)
is used to make a smooth transition (a  c-factor of 8 is used).</p>
<p>(<a class="reference external" href="./plots/s-curve-freezingsoil.py">Source code</a>, <a class="reference external" href="./plots/s-curve-freezingsoil.png">png</a>, <a class="reference external" href="./plots/s-curve-freezingsoil.hires.png">hires.png</a>, <a class="reference external" href="./plots/s-curve-freezingsoil.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/s-curve-freezingsoil.png" src="_images/s-curve-freezingsoil.png" />
</div>
</div>
<div class="section" id="sub-grid-runoff-generation">
<h3>Sub-grid runoff generation<a class="headerlink" href="#sub-grid-runoff-generation" title="Permalink to this headline">¶</a></h3>
<p>Sub-grid runoff generaten can be switched on on off in the configuration file. In
general this feature is used if the grid cell size is relatively lager compared
to the variation of topography. In addition you will need to have information
on the ditribution of altotude within a grid-cell. Depending on the topography sub-grid
runoff generation may be useful aroun 1x1km and larger.</p>
<p>The basis is formed by a sigmoid (<img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/>) function that is fitted using
a 10, 50 and 90 percentile  DEM. The <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> function is defined as:</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/56c5a3e8af85ec9c779cd5babf0c076930582a52.png" alt="S = 1.0/(b + e^{(-c (X - a))})"/></p>
</div></div></blockquote>
<p>Where:</p>
<blockquote>
<div><p>X = input variable (in this case the absolute scaled groundwater level)</p>
<p>b = 1.0</p>
<p>c = sharpness parameter. Higher values give sharper step</p>
<p>a = centre-point of the curve (normally the 50% DEM)</p>
</div></blockquote>
<p>The <img class="math" src="_images/math/3372c1cb6d68cf97c2d231acc0b47b95a9ed04cc.png" alt="c"/> parameter is estimated by reversing the function above to:</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/6e464fa417f49b3fa0d3b9a08e38be54ff1112c1.png" alt="c = log(1.0/p - 1)/(dem_{p} - dem_{50})"/></p>
</div></div></blockquote>
<p>where:</p>
<blockquote>
<div><p>percentile is the percentile of <img class="math" src="_images/math/52c502e203015692fa78373cd13275a77bff830d.png" alt="dem_{p}"/></p>
<p><img class="math" src="_images/math/282f9de1d84068df63bf35e5a254f24e8ab214b3.png" alt="dem_{50}"/> is the average altitude in the gridcell</p>
<p><img class="math" src="_images/math/52c502e203015692fa78373cd13275a77bff830d.png" alt="dem_{p}"/> is the altitude below with percentile (p) cells of the dem
are found</p>
</div></blockquote>
<p>The outcome of the <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> will range from 0 to 1 for inputs ranging from the
minimum altitude to the maximum altitude (within the gridcell). Thereore,
the calculated groundwater levels within the cell are scale to match the minimum and
maximum altitude within the cell using:</p>
<div class="math">
<p><img src="_images/math/c41422a8959293b45927970e511bbf7ba841304a.png" alt="G_s = (A_{max}-A_{min})/FZT/GWPerc"/></p>
</div><p>where:</p>
<blockquote>
<div><p><img class="math" src="_images/math/8760afb4c41319ff4c398efe5895460efceec1e7.png" alt="G_s"/> is the scaling factor</p>
<p><img class="math" src="_images/math/57ab05803d219bfc843f883cb50c0ffa0f57f6ab.png" alt="A_{max}"/> the maximum altitude within the cell</p>
<p><img class="math" src="_images/math/8790a5a854013e720367657743a90bea46a048d6.png" alt="A_{min}"/> the minumum altitude within the cell</p>
<p><img class="math" src="_images/math/9d6c4a88618b2925b43fe5e82a8b51586236ce8d.png" alt="FZT"/> the total thickness of the soil in the model</p>
<p><img class="math" src="_images/math/d9115f0b8b614fa0195051c0aedd10494aa644f9.png" alt="GWperc"/> is a dimensionless parameter (from &gt;0 to 1) that determines which
part of the soil profile generates runoff. If it is 1 runoff is generated whenever
there is groundwater in the system. If it is 0.1 only the top 10 % of the
soil profile generated runoff</p>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">DemMax</span><span class="o">=</span><span class="n">readmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Dir</span> <span class="o">+</span> <span class="s">&quot;/staticmaps/wflow_demmax&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">DrainageBase</span><span class="o">=</span><span class="n">readmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Dir</span> <span class="o">+</span> <span class="s">&quot;/staticmaps/wflow_demmin&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">CC</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span><span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">0.1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DrainageBase</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Altitude</span><span class="p">))</span>
<span class="bp">self</span><span class="o">.</span><span class="n">GWScale</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DemMax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">DrainageBase</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">FirstZoneThickness</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RunoffGeneratingGWPerc</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">at present the model uses the drainage base (minimum DEM) and treats this as the 10% percentile
to which the curve is fitted. So at present only two points are used (10 % and 50%)</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an poorly tested feature</p>
</div>
<p>In the dynamic section of the model the absolute groundwater level is determined and
scaled before it is
fed into the <img class="math" src="_images/math/ad28c83c99a8fd0dd2e2e594c9d02ee532765a0a.png" alt="S"/> curve function. The result is a estimated saturated fraction within a
the gridcell. The saturated fraction is used to generated Saturation Overland Flow (SOF)
and generate ouflow from the groundwater reservoir:</p>
<ol class="arabic simple">
<li>The saturated conductivity for the average groundwaterlevel is determined</li>
<li>The available water at the surface is multiplied by the saturated fraction and
added to the kinematic wave reservoir (SOF)</li>
<li>Outflow from the groundwater reservoir is determined using average slope multiplied
by the conductivity and the saturated fraction limited by the amount of water
in the groundwater reservoir.</li>
</ol>
<p>in dynamic:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">AbsoluteGW</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DemMax</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">GWScale</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">SubCellFrac</span> <span class="o">=</span> <span class="n">sCurve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AbsoluteGW</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CC</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Altitude</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">SubCellRunoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubCellFrac</span> <span class="o">*</span> <span class="n">FreeWaterDepth</span>
<span class="bp">self</span><span class="o">.</span><span class="n">SubCellGWRunoff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubCellFrac</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">FirstZoneDepth</span><span class="p">,</span>\
    <span class="bp">self</span><span class="o">.</span><span class="n">SubCellFrac</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Slope</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">FirstZoneKsatVer</span> <span class="o">*</span> \
    <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zi</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestepsecs</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">basetimestep</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">FirstZoneDepth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FirstZoneDepth</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">SubCellGWRunoff</span>
<span class="n">FreeWaterDepth</span> <span class="o">=</span> <span class="n">FreeWaterDepth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubCellRunoff</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="kinematic-wave-and-river-width">
<h2>Kinematic wave and River Width<a class="headerlink" href="#kinematic-wave-and-river-width" title="Permalink to this headline">¶</a></h2>
<p>The river width is determined from the DEM the upstream area and yearly
average discharge (<a class="reference internal" href="#finnegan">[Finnegan]</a>):</p>
<p>The early average Q at outlet is scaled for each point in the drainage network
with the upstream area. <img class="math" src="_images/math/10f32377ac67d94f764f12a15ea987e88c85d3e1.png" alt="\alpha"/> ranges from 5 to &gt; 60. Here 5 is used for hardrock,
largre values are used for sediments</p>
<p>Implementation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">upstr</span> <span class="o">=</span> <span class="n">catchmenttotal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TopoLdd</span><span class="p">)</span>
<span class="n">Qscale</span> <span class="o">=</span> <span class="n">upstr</span><span class="o">/</span><span class="n">mapmaximum</span><span class="p">(</span><span class="n">upstr</span><span class="p">)</span> <span class="o">*</span> <span class="n">Qmax</span>
<span class="n">W</span> <span class="o">=</span> <span class="p">(</span><span class="n">alf</span> <span class="o">*</span> <span class="p">(</span><span class="n">alf</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.6666666667</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">0.375</span><span class="p">)</span> <span class="o">*</span> <span class="n">Qscale</span><span class="o">**</span><span class="p">(</span><span class="mf">0.375</span><span class="p">)</span> <span class="o">*</span>\
     <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span><span class="n">windowaverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Slope</span><span class="p">,</span><span class="n">celllength</span><span class="p">()</span> <span class="o">*</span> <span class="mf">4.0</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1875</span><span class="p">)</span> <span class="o">*</span>\
     <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">**</span><span class="p">(</span><span class="mf">0.375</span><span class="p">)</span>
<span class="n">RiverWidth</span> <span class="o">=</span> <span class="n">W</span>
</pre></div>
</div>
<p>The table below list commonly used Manning&#8217;s N values (in the N_River .tbl file).
Please note that  the values for non river cells may arguably be set
significantly higher. (Use N.tbl for non-river cells and N_River.tbl for river cells)</p>
<table border="1" class="docutils">
<caption>Manning&#8217;s N values</caption>
<colgroup>
<col width="70%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type of Channel and Description</th>
<th class="head">Minimum</th>
<th class="head">Normal</th>
<th class="head">Maximum</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><em>Main Channels</em></td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>clean, straight, full stage, no rifts or deep pools</td>
<td>0.025</td>
<td>0.03</td>
<td>0.033</td>
</tr>
<tr class="row-even"><td>same as above, but more stones and weeds</td>
<td>0.03</td>
<td>0.035</td>
<td>0.04</td>
</tr>
<tr class="row-odd"><td>clean, winding, some pools and shoals</td>
<td>0.033</td>
<td>0.04</td>
<td>0.045</td>
</tr>
<tr class="row-even"><td>same as above, but some weeds and stones</td>
<td>0.035</td>
<td>0.045</td>
<td>0.05</td>
</tr>
<tr class="row-odd"><td>same as above, lower stages, more ineffective slopes and sections</td>
<td>0.04</td>
<td>0.048</td>
<td>0.055</td>
</tr>
<tr class="row-even"><td>same as second with more stones</td>
<td>0.045</td>
<td>0.05</td>
<td>0.06</td>
</tr>
<tr class="row-odd"><td>sluggish reaches, weedy, deep pools</td>
<td>0.05</td>
<td>0.07</td>
<td>0.08</td>
</tr>
<tr class="row-even"><td>very weedy reaches, deep pools, or floodways with heavy stand of timber and underbrush</td>
<td>0.075</td>
<td>0.1</td>
<td>0.15</td>
</tr>
<tr class="row-odd"><td><em>Mountain streams</em></td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>bottom: gravels, cobbles, and few  boulders</td>
<td>0.03</td>
<td>0.04</td>
<td>0.05</td>
</tr>
<tr class="row-odd"><td>bottom: cobbles with large boulders</td>
<td>0.04</td>
<td>0.05</td>
<td>0.07</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dynamic-wave">
<h2>Dynamic wave<a class="headerlink" href="#dynamic-wave" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As of version 0.93 this is moved to the wflow_wave module.</p>
</div>
<p>An <em>experimental</em> implementation of the full dynamic wave equations has been
implemented. The current implementation is fairly unstable and <em>very</em> slow.
It can be switched on by setting dynamicwave=1 in the [dynamicwave]
section of the ini file. See below for an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">dynamicwave</span><span class="p">]</span>
<span class="c"># Switch on dynamic wave for main rivers</span>
<span class="n">dynamicwave</span><span class="o">=</span><span class="mi">1</span>

<span class="c"># Number of timeslices per dynamic wave substep</span>
<span class="n">TsliceDyn</span><span class="o">=</span><span class="mi">100</span>

<span class="c"># number of substeps for the dynamic wave with respect to the model timesteps</span>
<span class="n">dynsubsteps</span><span class="o">=</span><span class="mi">24</span>

<span class="c"># map with level boundary points</span>
<span class="n">wflow_hboun</span> <span class="o">=</span> <span class="n">staticmaps</span><span class="o">/</span><span class="n">wflow_outlet</span><span class="o">.</span><span class="n">map</span>

<span class="c"># Optional river map for the dynamic wave that must be the same size or smaller as that of the</span>
<span class="c"># kinematic wave</span>
<span class="n">wflow_dynriver</span> <span class="o">=</span> <span class="n">staticmaps</span><span class="o">/</span><span class="n">wflow_dynriver</span><span class="o">.</span><span class="n">map</span>

<span class="c"># a fixed water level for each non-zero point in the wflow_hboun map</span>
<span class="c"># level &gt; 0.0 use that level</span>
<span class="c"># level == 0.0 use supplied timeseries (see levelTss)</span>
<span class="c"># level &lt; 0.0 use upstream water level</span>
<span class="n">fixedLevel</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="c"># if this is set the program will try to keep the volume at the pits at</span>
<span class="c"># a constant value</span>
<span class="n">lowerflowbound</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c"># instead of a fixed level a tss file with levels for each timesteps and each</span>
<span class="c"># non-zero value in the wflow_hboun map</span>
<span class="c">#levelTss=intss/Hboun.tss</span>

<span class="c"># If set to 1 the program will try to optimise the timestep</span>
<span class="c"># Experimental, mintimestep is the smallest to be used</span>
<span class="c">#AdaptiveTimeStepping = 1</span>
<span class="c">#mintimestep =1.0</span>
</pre></div>
</div>
<p>A description of the implementation of the dynamicwave is given on the
<a class="reference external" href="http://pcraster.geo.uu.nl/documentation/PCRaster/html/op_dynamicwave.html">pcraster website</a>.</p>
<p>In addition to the settings in the ini file you need to give the model additional maps
or lookuptables:</p>
<ul class="simple">
<li>ChannelDepth.[map|tbl] - depth of the main channel in metres</li>
<li>ChannelRoughness.[map|tbl] - manning roughness coefficient (default = 0.03)</li>
<li>ChannelForm.[map|tbl] - form of the chnaggel (default = 0.0)</li>
<li>FloodplainWidth.[map|tbl] - width of the floodplain in metres (default = )</li>
</ul>
<p>The following variables for the dynamicwave function are set as follows:</p>
<ul class="simple">
<li>ChannelBottomLevel - Taken from the dem</li>
<li>ChannelLength - Taken from the length in the kinematic wave</li>
<li>ChannelBottomWidth - taken from the wflow_riverwidth map (this map can be user supplied
or when it is not supplied a geomorphological relation is used)</li>
</ul>
<p>Becuase the dynamic wave can be unstable priming the model with new initial
conditions is best done in several steps:</p>
<ol class="arabic simple">
<li>Run the model with the -I option and the dynamic wave switch off</li>
<li>Copy back the resulting state files to the instate directory</li>
<li>Re-run the model with the without the -I option</li>
<li>Copy back the resulting states of the Dynamic wave to the instate directory</li>
</ol>
</div>
<div class="section" id="model-variables-stores-and-fluxes">
<h2>Model variables stores and fluxes<a class="headerlink" href="#model-variables-stores-and-fluxes" title="Permalink to this headline">¶</a></h2>
<p>The diagram below shows the stores and fluxes in the model in terms of internal variable names. It
onlys shows the soil and Kinematic wave reservoir, not the canopy model.</p>
<p class="graphviz">
<img src="_images/graphviz-e5ec7992f1213e7eae816d6610041254d14f0520.png" alt="digraph grids {
compound=true;
node[shape=record];
UStoreDepth [shape=box];
OutSide [style=dotted];
FirstZoneDepth [shape=box];
UStoreDepth -&gt; FirstZoneDepth [label=&quot;Transfer [mm]&quot;];
FirstZoneDepth -&gt; UStoreDepth [label=&quot;CapFlux [mm]&quot;];
FirstZoneDepth -&gt;KinematicWaveStore [label=&quot;ExfiltWaterCubic [m^3/s]&quot;];
&quot;OutSide&quot; -&gt; UStoreDepth [label=&quot;ActInfilt [mm]&quot;];
UStoreDepth -&gt; OutSide [label=&quot;ActEvapUStore [mm]&quot;];
FirstZoneDepth -&gt; OutSide [label=&quot;ActEvap-ActEvapUStore [mm]&quot;];
FirstZoneDepth -&gt; KinematicWaveStore [label=&quot;SubCellGWRunoffCubic [m^3/s]&quot;];
&quot;OutSide&quot; -&gt; KinematicWaveStore [label=&quot;SubCellRunoffCubic [m^3/s]&quot;];
&quot;OutSide&quot; -&gt; KinematicWaveStore [label=&quot;RunoffOpenWater [m^3/s]&quot;] ;
&quot;OutSide&quot; -&gt; KinematicWaveStore [label=&quot;FreeWaterDepthCubic [m^3/s]&quot;] ;
}" />
</p>
</div>
<div class="section" id="processing-of-meteorological-forcing-data">
<h2>Processing of meteorological forcing data<a class="headerlink" href="#processing-of-meteorological-forcing-data" title="Permalink to this headline">¶</a></h2>
<p>Although the model has been setup to do as little data processing
as possible it includes an option to apply an altitude correction to the
temperature inputs. The three squares below demonstrate the principle.</p>
<p class="graphviz">
<img src="_images/graphviz-9d79b274e101d98314c7413137746824ea5ce6b1.png" alt="digraph grids {
node[shape=record];
a[label=&quot;{5|5|5}|{5|5|5}|{5|5|5}&quot;];
b[label=&quot;{1|2|3}|{4|5|6}|{7|8|9}&quot;];
c[label=&quot;{4|3|2}|{1|0|-1}|{-2|-3|-4}&quot;];
  &quot;Average T input grid&quot; -&gt; a
  &quot;Correction per cell&quot; -&gt; b
  &quot;Resulting T&quot; -&gt; c
}" />
</p>
<p>wflow_sbm takes the correction grid as input and applies this to the input
temperature. The correction grid has to be made outside of the model.
The correction grid is optional.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The temperature correction map is specified in the model section of the ini file:</p>
<p>[model]
TemperatureCorrectionMap=NameOfTheMap</p>
<p class="last">If the entry is not in the file the correction will not be applied</p>
</div>
</div>
<div class="section" id="guidelines-for-wflowsbm-model-parameters">
<h2>Guidelines for wflowsbm model parameters<a class="headerlink" href="#guidelines-for-wflowsbm-model-parameters" title="Permalink to this headline">¶</a></h2>
<p>The tables below shows the most important parameters and suggested ranges</p>
<p>CanopyGapFraction
<a class="reference external" href="file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/Cfmax.tbl">file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/Cfmax.tbl</a></p>
<ul class="simple">
<li>EoverR - Ratio of average wet canopy evaporation rate over
precipitation rate - usually between 0.06 and 0.15 depending on climate and site.</li>
<li>FirstZoneCapacity -</li>
</ul>
<div class="highlight-python"><pre>FirstZoneKsatVer.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/FirstZoneMinCapacity.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/InfiltCapPath.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/InfiltCapSoil.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/M.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/MaxCanopyStorage.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/MaxLeakage.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/N_River.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/N.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/RootingDepth.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/RunoffGeneratingGWPerc.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/thetaR.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/thetaS.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/TT.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/TTI.tbl
file:///media/schelle/BIG/LINUX/wflow/cases/maas/intbl/WHC.tbl</pre>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils citation" frame="void" id="vertessy" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[vertessy]</a></td><td>Vertessy, R.A. and H. Elsenbeer, “Distributed modelling of storm flow generation in an Amazonian rainforest catchment: effects of model parameterization,” Water Resources Research, vol. 35, no. 7, pp. 2173–2187, 1999.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="finnegan" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[Finnegan]</a></td><td>Noah J. Finnegan et al 2005 Controls on the channel width of rivers: Implications for modeling fluvial incision of bedrock&#8221;</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="wigmosta" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[Wigmosta]</a></td><td>Wigmosta, M. S., L. J. Lane, J. D. Tagestad, and A. M. Coleman (2009), Hydrologic and erosion models to assess land use and management practices affecting soil erosion, Journal of Hydrologic Engineering, 14(1), 27-41.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="module-wflow_sbm">
<span id="wflow-sbm-module-documentation"></span><h2>wflow_sbm module documentation<a class="headerlink" href="#module-wflow_sbm" title="Permalink to this headline">¶</a></h2>
<p>Run the wflow_sbm hydrological model..</p>
<p>usage</p>
<div class="highlight-python"><pre>wflow_sbm [-h][-v level][-F runinfofile][-L logfile][-C casename][-R runId]
      [-c configfile][-T last_step][-S first_step][-s seconds][-W][-E][-N][-U discharge]
      [-P parameter multiplication][-X][-f][-I][-i tbl_dir][-x subcatchId][-u updatecols]
      [-p inputparameter multiplication][-l loglevel]
      
-F: if set wflow is expected to be run by FEWS. It will determine
    the timesteps from the runinfo.xml file and save the output initial
    conditions to an alternate location. Also set fewsrun=1 in the .ini file!
    
-X: save state at the end of the run over the initial conditions at the start        

-f: Force overwrite of existing results    

-T: Set last timestep

-S: Set the start timestep (default = 1)

-s: Set the model timesteps in seconds

-I: re-initialize the initial model conditions with default

-i: Set input table directory (default is intbl)

-x: Apply multipliers (-P/-p ) for subcatchment only (e.g. -x 1)

-C: set the name  of the case (directory) to run

-R: set the name runId within the current case

-L: set the logfile

-E: Switch on reinfiltration of overland flow

-c: name of wflow the configuration file (default: Casename/wflow_sbm.ini). 

-h: print usage information

-W: If set, this flag indicates that an ldd is created for the water level
    for each timestep. If not the water is assumed to flow according to the 
    DEM. Wflow will run a lot slower with this option. Most of the time
    (shallow soil, steep topography) you do not need this option. Also, if you 
    need it you migth actually need another model.
    
-U: The argument to this option should be a .tss file with measured discharge in
    [m^3/s] which the progam will use to update the internal state to match 
    the measured flow. The number of columns in this file should match the 
    number of gauges in the wflow\_gauges.map file.

-u: list of gauges/columns to use in update. Format:
    -u [1 , 4 ,13]
    The above example uses column 1, 4 and 13
    
-P: set parameter multiply dictionary (e.g: -P {'self.FirstZoneDepth' : 1.2}
    to increase self.FirstZoneDepth by 20%, multiply with 1.2)
    
-p: set input parameter (dynamic, e.g. precip) multiply dictionary 
    (e.g: -p {'self.Precipitation' : 1.2} to increase Precipitation 
    by 20%, multiply with 1.2)    
    
-l: loglevel (most be one of DEBUG, WARNING, ERROR)</pre>
</div>
<p>$Author: schelle $
$Id: wflow_sbm.py 900 2014-01-09 17:41:06Z schelle $
$Rev: 900 $</p>
<dl class="function">
<dt id="wflow_sbm.SnowPackHBV">
<tt class="descclassname">wflow_sbm.</tt><tt class="descname">SnowPackHBV</tt><big>(</big><em>Snow</em>, <em>SnowWater</em>, <em>Precipitation</em>, <em>Temperature</em>, <em>TTI</em>, <em>TT</em>, <em>Cfmax</em>, <em>WHC</em><big>)</big><a class="headerlink" href="#wflow_sbm.SnowPackHBV" title="Permalink to this definition">¶</a></dt>
<dd><p>HBV Type snowpack modelling using a Temperature degree factor. All correction
factors (RFCF and SFCF) are set to 1. The refreezing efficiency factor is set to 0.05.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first simple">
<li><strong>Snow</strong> &#8211; </li>
<li><strong>SnowWater</strong> &#8211; </li>
<li><strong>Precipitation</strong> &#8211; </li>
<li><strong>Temperature</strong> &#8211; </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Snow,SnowMelt,Precipitation</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="wflow_sbm.WflowModel">
<em class="property">class </em><tt class="descclassname">wflow_sbm.</tt><tt class="descname">WflowModel</tt><big>(</big><em>cloneMap</em>, <em>Dir</em>, <em>RunDir</em>, <em>configfile</em><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">pcraster.framework.dynamicPCRasterBase.DynamicModel</span></tt></p>
<p class="versionchanged">
<span class="versionmodified">Changed in version 0.91: </span>- Calculation of GWScale moved to resume() to allow fitting.</p>
<p class="versionadded">
<span class="versionmodified">New in version 0.91: </span>- added S-curve for freezing soil infiltration reduction calculations</p>
<dl class="method">
<dt id="wflow_sbm.WflowModel.dynamic">
<tt class="descname">dynamic</tt><big>(</big><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel.dynamic" title="Permalink to this definition">¶</a></dt>
<dd><p>Stuf that is done for each timestep</p>
<p>Below a list of variables that can be save to disk as maps or as 
timeseries (see ini file for syntax):</p>
<p><em>Dynamic variables</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>self.Precipitation</strong> &#8211; Gross precipitation [mm]</li>
<li><strong>self.Temperature</strong> &#8211; Air temperature [oC]</li>
<li><strong>self.PotenEvap</strong> &#8211; Potential evapotranspiration [mm]</li>
<li><strong>self.PotTrans</strong> &#8211; Potential Transpiration (after subtracting Interception from PotenEvap) [mm]</li>
<li><strong>self.Interception</strong> &#8211; Actual rainfall interception [mm]</li>
<li><strong>self.ActEvap</strong> &#8211; Actual evaporation [mm]</li>
<li><strong>self.SurfaceRunoff</strong> &#8211; Surface runoff in the kinematic wave [m^3/s]</li>
<li><strong>self.SurfaceRunoffDyn</strong> &#8211; Surface runoff in the dyn-wave resrvoir [m^3/s]</li>
<li><strong>self.WaterLevelDyn</strong> &#8211; Water level in the dyn-wave resrvoir [m^]</li>
<li><strong>self.ActEvap</strong> &#8211; Actual EvapoTranspiration [mm]</li>
<li><strong>self.WaterLevel</strong> &#8211; Water level in the kinematic wave [m] (above the bottom)</li>
<li><strong>self.ActInfilt</strong> &#8211; Actual infiltration into the unsaturated zone [mm]</li>
<li><strong>self.CanopyStorage</strong> &#8211; actual canopystorage (only for subdaily timesteps) [mm]</li>
<li><strong>self.FirstZoneDepth</strong> &#8211; Amount of water in the saturated store [mm]</li>
<li><strong>self.UStoreDepth</strong> &#8211; Amount of water in the unsaturated store [mm]</li>
<li><strong>self.Snow</strong> &#8211; Snow depth [mm]</li>
<li><strong>self.SnowWater</strong> &#8211; water content of the snow [mm]</li>
<li><strong>self.TSoil</strong> &#8211; Top soil temperature [oC]</li>
<li><strong>self.FirstZoneDepth</strong> &#8211; amount of available water in the saturated part of the soil [mm]</li>
<li><strong>self.UStoreDepth</strong> &#8211; amount of available water in the unsaturated zone [mm]</li>
<li><strong>self.Transfer</strong> &#8211; downward flux from unsaturated to saturated zone [mm]</li>
<li><strong>self.CapFlux</strong> &#8211; capilary flux from saturated to unsaturated zone [mm]</li>
<li><strong>self.CanopyStorage</strong> &#8211; Amount of water on the Canopy [mm]</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Static variables</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>self.Altitude</strong> &#8211; The altitude of each cell [m]</li>
<li><strong>self.Bw</strong> &#8211; Width of the river [m]</li>
<li><strong>self.River</strong> &#8211; booolean map indicating the presence of a river [-]</li>
<li><strong>self.DLC</strong> &#8211; length of the river within a cell [m]</li>
<li><strong>self.ToCubic</strong> &#8211; Mutiplier to convert mm to m^3/s for fluxes</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wflow_sbm.WflowModel.initial">
<tt class="descname">initial</tt><big>(</big><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel.initial" title="Permalink to this definition">¶</a></dt>
<dd><p>Initial part of the model, executed only once. Reads all static data from disk</p>
<p><em>Soil</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>M.tbl</strong> &#8211; M parameter in the SBM model. Governs the decay of Ksat with depth [-]</li>
<li><strong>thetaR.tbl</strong> &#8211; Residual water content [mm/mm]</li>
<li><strong>thetaS.tbl</strong> &#8211; Saturated water content (porosity) [mm/mm]</li>
<li><strong>FirstZoneKsatVer.tbl</strong> &#8211; Saturated conductivity [mm/d]</li>
<li><strong>PathFrac.tbl</strong> &#8211; Fraction of compacted area per grid cell [-]</li>
<li><strong>InfiltCapSoil.tbl</strong> &#8211; Soil infiltration capacity [m/d]</li>
<li><strong>InfiltCapPath.tbl</strong> &#8211; Infiltration capacity of the compacted areas [mm/d]</li>
<li><strong>FirstZoneMinCapacity.tbl</strong> &#8211; Minimum wdepth of the soil [mm]</li>
<li><strong>FirstZoneCapacity.tbl</strong> &#8211; Maximum depth of the soil [m]</li>
<li><strong>RootingDepth.tbl</strong> &#8211; Depth of the roots [mm]</li>
<li><strong>MaxLeakage.tbl</strong> &#8211; Maximum leakage out of the soil profile [mm/d]</li>
<li><strong>CapScale.tbl</strong> &#8211; Scaling factor in the Capilary rise calculations (100) [mm/d]</li>
<li><strong>RunoffGeneratingGWPerc</strong> &#8211; Fraction of the soil depth that contributes to subcell runoff (0.1) [-]</li>
<li><strong>rootdistpar.tbl</strong> &#8211; Determine how roots are linked to water table. The number 
should be negative. A more negative  number means that all roots are wet if the water 
table is above the lowest part of the roots. 
A less negative number smooths this. [mm] (default = -80000)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Canopy</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>CanopyGapFraction.tbl</strong> &#8211; Fraction of precipitation that does not hit the canopy directly [-]</li>
<li><strong>MaxCanopyStorage.tbl</strong> &#8211; Canopy interception storage capacity [mm]</li>
<li><strong>EoverR.tbl</strong> &#8211; Ratio of average wet canopy evaporation rate over rainfall rate [-]</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Surface water</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>N.tbl</strong> &#8211; Manning&#8217;s N parameter</li>
<li><strong>N_river.tbl</strong> &#8211; Manning&#8217;s N parameter fro cells marked as river</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Snow and frozen soil modelling parameters</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>cf_soil.tbl</strong> &#8211; Soil infiltration reduction factor when soil is frozen [-] (&lt; 1.0)</li>
<li><strong>TTI.tbl</strong> &#8211; critical temperature for snowmelt and refreezing  (1.000) [oC]</li>
<li><strong>TT.tbl</strong> &#8211; defines interval in which precipitation falls as rainfall and snowfall (-1.41934) [oC]</li>
<li><strong>Cfmax.tbl</strong> &#8211; meltconstant in temperature-index ( 3.75653) [-]</li>
<li><strong>WHC.tbl</strong> &#8211; fraction of Snowvolume that can store water (0.1) [-]</li>
<li><strong>w_soil.tbl</strong> &#8211; Soil temperature smooth factor. Given for daily timesteps. (0.1125) [-] Wigmosta, M. S., L. J. Lane, J. D. Tagestad, and A. M. Coleman (2009).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wflow_sbm.WflowModel.resume">
<tt class="descname">resume</tt><big>(</big><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel.resume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wflow_sbm.WflowModel.stateVariables">
<tt class="descname">stateVariables</tt><big>(</big><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel.stateVariables" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>returns a list of state variables that are essential to the model. </dt>
<dd><p class="first">This list is essential for the resume and suspend functions to work.</p>
<p class="last">This function is specific for each model and <strong>must</strong> be present.</p>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>self.SurfaceRunoff</strong> &#8211; Surface runoff in the kin-wave resrvoir [m^3/s]</li>
<li><strong>self.SurfaceRunoffDyn</strong> &#8211; Surface runoff in the dyn-wave resrvoir [m^3/s]</li>
<li><strong>self.WaterLevel</strong> &#8211; Water level in the kin-wave resrvoir [m]</li>
<li><strong>self.WaterLevelDyn</strong> &#8211; Water level in the dyn-wave resrvoir [m^]</li>
<li><strong>self.Snow</strong> &#8211; Snow pack [mm]</li>
<li><strong>self.SnowWater</strong> &#8211; Snow pack water [mm]</li>
<li><strong>self.TSoil</strong> &#8211; Top soil temperature [oC]</li>
<li><strong>self.UStoreDepth</strong> &#8211; Water in the Unsaturated Store [mm]</li>
<li><strong>self.FirstZoneDepth</strong> &#8211; Water in the saturated store [mm]</li>
<li><strong>self.CanopyStorage</strong> &#8211; Amount of water on the Canopy [mm]</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wflow_sbm.WflowModel.supplyCurrentTime">
<tt class="descname">supplyCurrentTime</tt><big>(</big><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel.supplyCurrentTime" title="Permalink to this definition">¶</a></dt>
<dd><p>gets the current time in seconds after the start of the run</p>
</dd></dl>

<dl class="method">
<dt id="wflow_sbm.WflowModel.suspend">
<tt class="descname">suspend</tt><big>(</big><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel.suspend" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wflow_sbm.WflowModel.updateRunOff">
<tt class="descname">updateRunOff</tt><big>(</big><big>)</big><a class="headerlink" href="#wflow_sbm.WflowModel.updateRunOff" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the kinematic wave reservoir. Should be run after updates to Q</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="wflow_sbm.actEvap_SBM">
<tt class="descclassname">wflow_sbm.</tt><tt class="descname">actEvap_SBM</tt><big>(</big><em>RootingDepth</em>, <em>WTable</em>, <em>UStoreDepth</em>, <em>FirstZoneDepth</em>, <em>PotTrans</em>, <em>smoothpar</em><big>)</big><a class="headerlink" href="#wflow_sbm.actEvap_SBM" title="Permalink to this definition">¶</a></dt>
<dd><p>Actual evaporation function:</p>
<ul class="simple">
<li>first try to get demand from the saturated zone, using the rootingdepth as a limiting factor</li>
<li>secondly try to get the remaining water from the unsaturated store</li>
<li>it uses an S-Curve the make sure roots het wet/dry gradually (basically)
representing a root-depth distribution</li>
</ul>
<p>Input:</p>
<blockquote>
<div><ul class="simple">
<li>RootingDepth,WTable, UStoreDepth,FirstZoneDepth, PotTrans, smoothpar</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li>ActEvap,  FirstZoneDepth,  UStoreDepth ActEvapUStore</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="wflow_sbm.main">
<tt class="descclassname">wflow_sbm.</tt><tt class="descname">main</tt><big>(</big><em>argv=None</em><big>)</big><a class="headerlink" href="#wflow_sbm.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform command line execution of the model.</p>
</dd></dl>

<dl class="function">
<dt id="wflow_sbm.usage">
<tt class="descclassname">wflow_sbm.</tt><tt class="descname">usage</tt><big>(</big><em>*args</em><big>)</big><a class="headerlink" href="#wflow_sbm.usage" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="wflow_gr4.html" class="btn btn-neutral float-right" title="The wflow_gr4 model"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="wflow_hbv.html" class="btn btn-neutral" title="The wflow_hbv model"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2013-2014, Deltares/Jaap Schellekens.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>